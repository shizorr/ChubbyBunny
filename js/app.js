"use strict";var ChubbyBunny=ChubbyBunny||{};ChubbyBunny.WORLD_MIN=new Phaser.Point(-256,0),ChubbyBunny.WORLD_MAX=new Phaser.Point(240,160),ChubbyBunny.FLOOR_Y=128,ChubbyBunny.FLOOR_HEIGHT=32,ChubbyBunny.WALL_WIDTH=32,ChubbyBunny.GRAVITY=814,ChubbyBunny.BUNNY_MIN_X=ChubbyBunny.WORLD_MIN.x+ChubbyBunny.WALL_WIDTH+8,ChubbyBunny.Bunny=function(a,b){this._rnd=a.rnd,this._timer=0,this._moveTo=0,this._force=new Phaser.Point(0,0),this._offset=0;var c=a.add.sprite(0,0,"bunny",null,b);c.anchor.setTo(.5,1),c.animations.add("idle",[0,1,2,3,4,5],12,!0),c.animations.add("walk",[6,7,8,9,10,11],12,!0),c.animations.add("kiss",[12,13,14,15],12,!0),c.animations.add("born",[16,17,18,19,20,21,22,23],16,!1),this.sprite=c},ChubbyBunny.Bunny.STATES={INACTIVE:-1,IDLE:0,WALK:1,WAIT:2,KISS:3,THROWN:4,BORN:5,IN_FOX_MOUTH:6},ChubbyBunny.Bunny.WALK_SPEED=40,ChubbyBunny.Bunny.IDLE_TIME_MIN=2,ChubbyBunny.Bunny.IDLE_TIME_MAX=5,ChubbyBunny.Bunny.MOVE_OFFSET_MIN=50,ChubbyBunny.Bunny.MOVE_OFFSET_MAX=100,ChubbyBunny.Bunny.PICK_WIDTH=32,ChubbyBunny.Bunny.THROWN_FORCE_X=200,ChubbyBunny.Bunny.THROWN_FORCE_Y=-100,ChubbyBunny.Bunny.prototype.initialize=function(){this._state=ChubbyBunny.Bunny.STATES.INACTIVE,this.sprite.visible=!1},ChubbyBunny.Bunny.prototype.update=function(a,b){this._timer-=a;var c=this._moveTo-this.sprite.x,d=Math.sign(c);switch(c=Math.abs(c),this._state){case ChubbyBunny.Bunny.STATES.IDLE:if(this._timer<=0){var e=Math.sign(this._rnd.normal())*this._rnd.between(ChubbyBunny.Bunny.MOVE_OFFSET_MIN,ChubbyBunny.Bunny.MOVE_OFFSET_MAX);this._moveTo=this.sprite.x+e,this._setState(ChubbyBunny.Bunny.STATES.WALK)}break;case ChubbyBunny.Bunny.STATES.WALK:this.sprite.x+=d*a*ChubbyBunny.Bunny.WALK_SPEED,this.flipSpriteX(d<0),this.sprite.x<ChubbyBunny.BUNNY_MIN_X&&(this._moveTo=this.sprite.x+(this.sprite.x-this._moveTo)),Math.abs(c)<1&&this._setState(ChubbyBunny.Bunny.STATES.IDLE);break;case ChubbyBunny.Bunny.STATES.THROWN:this.sprite.x+=this._force.x*a,this.sprite.y+=this._force.y*a,this._force.y+=ChubbyBunny.GRAVITY*a,this.sprite.y>=ChubbyBunny.FLOOR_Y&&(this.sprite.y=ChubbyBunny.FLOOR_Y,this._setState(ChubbyBunny.Bunny.STATES.IDLE));break;case ChubbyBunny.Bunny.STATES.BORN:this.sprite.animations.currentAnim.isFinished&&this._setState(ChubbyBunny.Bunny.STATES.IDLE);break;case ChubbyBunny.Bunny.STATES.IN_FOX_MOUTH:this.sprite.x=b.x+this._offset}this._state!==ChubbyBunny.Bunny.STATES.IN_FOX_MOUTH&&(this.sprite.x<ChubbyBunny.BUNNY_MIN_X&&(this.sprite.x=ChubbyBunny.BUNNY_MIN_X),this.sprite.x>b.x&&(this._setState(ChubbyBunny.Bunny.STATES.IN_FOX_MOUTH),b.addBunny()))},ChubbyBunny.Bunny.prototype.render=function(){},ChubbyBunny.Bunny.prototype.spawn=function(a,b){this.sprite.x=a,this.sprite.y=ChubbyBunny.FLOOR_Y,this.flipSpriteX(0===this._rnd.between(0,1)),this.sprite.visible=!0,void 0===b||b===!1?this._setState(ChubbyBunny.Bunny.STATES.BORN):this.resume()},ChubbyBunny.Bunny.prototype.isActive=function(){return this._state!==ChubbyBunny.Bunny.STATES.INACTIVE},ChubbyBunny.Bunny.prototype.canBePicked=function(){return!(this._state===ChubbyBunny.Bunny.STATES.THROWN||this._state===ChubbyBunny.Bunny.STATES.BORN)},ChubbyBunny.Bunny.prototype.spriteContains=function(a,b){var c=ChubbyBunny.Bunny.PICK_WIDTH,d=this.sprite.height,e=this.sprite.x-c/2,f=this.sprite.top,g=new Phaser.Rectangle(e,f,c,d);return g.contains(a,b)},ChubbyBunny.Bunny.prototype.wait=function(){this._setState(ChubbyBunny.Bunny.STATES.WAIT)},ChubbyBunny.Bunny.prototype.resume=function(){this._setState(ChubbyBunny.Bunny.STATES.IDLE)},ChubbyBunny.Bunny.prototype.kiss=function(){this._setState(ChubbyBunny.Bunny.STATES.KISS),this.sprite.bringToTop()},ChubbyBunny.Bunny.prototype.throw=function(){this._setState(ChubbyBunny.Bunny.STATES.THROWN)},ChubbyBunny.Bunny.prototype.consume=function(){this._state===ChubbyBunny.Bunny.STATES.IN_FOX_MOUTH&&this.initialize()},ChubbyBunny.Bunny.prototype.flipSpriteX=function(a){this.sprite.scale.x=(a?-1:1)*Math.abs(this.sprite.scale.x)},ChubbyBunny.Bunny.prototype._setState=function(a){switch(this._state=a,this._state){case ChubbyBunny.Bunny.STATES.IDLE:this._timer=this._rnd.realInRange(ChubbyBunny.Bunny.IDLE_TIME_MIN,ChubbyBunny.Bunny.IDLE_TIME_MAX),this.sprite.animations.play("idle");break;case ChubbyBunny.Bunny.STATES.WALK:this.sprite.animations.play("walk");break;case ChubbyBunny.Bunny.STATES.WAIT:this.sprite.animations.play("idle");break;case ChubbyBunny.Bunny.STATES.KISS:this.sprite.animations.play("kiss");break;case ChubbyBunny.Bunny.STATES.THROWN:this._force.x=ChubbyBunny.Bunny.THROWN_FORCE_X*Math.sign(this.sprite.scale.x),this._force.y=ChubbyBunny.Bunny.THROWN_FORCE_Y;break;case ChubbyBunny.Bunny.STATES.BORN:this.sprite.animations.play("born");break;case ChubbyBunny.Bunny.STATES.IN_FOX_MOUTH:this._offset=Math.round(25*Math.random())+25,this.sprite.animations.play("idle"),this.sprite.scale.x=-Math.abs(this.sprite.scale.x),this.sprite.y=122}},ChubbyBunny.Fox=function(a){this._timer=0;for(var b=a.add.group(),c=["fox_body_bg","fox_body_fg","fox_head_bg"],d=0,e=c.length;d<e;d++){var f=a.add.sprite(0,0,c[d],null,b);f.anchor.setTo(0,1)}b.scale.setTo(2,2),b.y=ChubbyBunny.FLOOR_Y,this._body=b;var g=a.add.sprite(0,0,"fox_head_fg");g.anchor.setTo(0,1),g.scale.setTo(2,2),g.y=ChubbyBunny.FLOOR_Y,g.animations.add("idle",[0],0,!1),g.animations.add("snap",[0,1,2,3,4,5,6,7,8,9,0],24,!1),g.animations.add("close",[0,1,2,3,4,5],24,!1),g.animations.add("aboutToSnap",[0,1,2,1],1,!0),this.head=g,this.bunniesEaten=!1},ChubbyBunny.Fox.INITIAL_X=128,ChubbyBunny.Fox.SNAP_TIME=10,ChubbyBunny.Fox.SNAP_INCREMENT=2.3,ChubbyBunny.Fox.SPEED_MIN=4,ChubbyBunny.Fox.SPEED_MAX=8,ChubbyBunny.Fox.BUNNY_SPEED_MULTIPLIER=1,ChubbyBunny.Fox.prototype.initialize=function(){this.numBunnies=0,this._body.x=ChubbyBunny.Fox.INITIAL_X,this.head.x=ChubbyBunny.Fox.INITIAL_X,this.head.animations.play("idle"),this.x=ChubbyBunny.Fox.INITIAL_X},ChubbyBunny.Fox.prototype.update=function(a){this.bunniesEaten=!1,this.numBunnies>0&&(this._timer-=a,this._timer<=0?(this.bunniesEaten=!0,this.numBunnies=0,this.head.animations.play("snap")):this.head.animations.currentAnim.speed=Math.max(ChubbyBunny.Fox.SNAP_TIME-this._timer,1));var b=Math.max(ChubbyBunny.Fox.SPEED_MAX-this.numBunnies*ChubbyBunny.Fox.BUNNY_SPEED_MULTIPLIER,ChubbyBunny.Fox.SPEED_MIN);this.x-=b*a,this._body.x=this.head.x=this.x},ChubbyBunny.Fox.prototype.addBunny=function(){this.numBunnies++<=0?(this._timer=ChubbyBunny.Fox.SNAP_TIME,this.head.animations.play("aboutToSnap")):this._timer+=ChubbyBunny.Fox.SNAP_INCREMENT},ChubbyBunny.Fox.prototype.choke=function(){this.head.animations.play("close")},ChubbyBunny.Fox.prototype.eatPlayer=function(){this.head.animations.play("close")},ChubbyBunny.Player=function(a){var b=a.add.sprite(this._moveto,ChubbyBunny.FLOOR_Y,"bunny");b.anchor.setTo(.5,1),b.animations.add("idle",[0,1,2,3,4,5],12,!0),b.animations.add("walk",[6,7,8,9,10,11],12,!0),b.animations.add("kiss",[12,13,14,15],12,!0),b.animations.add("carry_idle",[24],0,!1),b.animations.add("carry_walk",[25,26,27,28,29,30],12,!0),b.animations.play("idle"),this.sprite=b,this._sfxPickUp=a.add.audio("pick_up",.7),this._sfxThrow=a.add.audio("throw",.7)},ChubbyBunny.Player.STATES={IDLE:0,WALK:1,KISS:2,CARRY_IDLE:3,CARRY_WALK:4},ChubbyBunny.Player.WALK_DEATH_ZONE=8,ChubbyBunny.Player.WALK_SPEED=60,ChubbyBunny.Player.KISS_DISTANCE=16,ChubbyBunny.Player.PICK_UP_DISTANCE=8,ChubbyBunny.Player.CARRY_OFFSET_Y=-24,ChubbyBunny.Player.prototype.initialize=function(){this._setState(ChubbyBunny.Player.STATES.IDLE),this._moveto=this.sprite.x=0,this._target=null,this.love=1,this.spawnBunnies=!1},ChubbyBunny.Player.prototype.update=function(a,b){this.spawnBunnies=!1,b.isDown&&(this._moveto=b.worldX);var c=this._moveto-this.sprite.x,d=Math.sign(c);switch(c=Math.abs(c),this.love=this._state===ChubbyBunny.Player.STATES.KISS?Math.max(this.love-.25*a,0):Math.min(this.love+.15*a,1),this._state){case ChubbyBunny.Player.STATES.IDLE:case ChubbyBunny.Player.STATES.WALK:if(null!==this._target){if(this.love>=1&&c<ChubbyBunny.Player.KISS_DISTANCE){this._setState(ChubbyBunny.Player.STATES.KISS);break}if(c<ChubbyBunny.Player.PICK_UP_DISTANCE){this._setState(ChubbyBunny.Player.STATES.CARRY_IDLE),this._sfxPickUp.play();break}}}switch(this._state){case ChubbyBunny.Player.STATES.IDLE:c>=ChubbyBunny.Player.WALK_DEATH_ZONE&&this._setState(ChubbyBunny.Player.STATES.WALK);break;case ChubbyBunny.Player.STATES.WALK:c<ChubbyBunny.Player.WALK_DEATH_ZONE/2?this._setState(ChubbyBunny.Player.STATES.IDLE):(this.sprite.x+=d*a*ChubbyBunny.Player.WALK_SPEED,this._flipSpriteX(d<0));break;case ChubbyBunny.Player.STATES.KISS:this.love<=0?(this._setState(ChubbyBunny.Player.STATES.IDLE),this._target.resume(),this._target=null,this.spawnBunnies=!0):null===this._target&&this._setState(ChubbyBunny.Player.STATES.IDLE);break;case ChubbyBunny.Player.STATES.CARRY_IDLE:c>=ChubbyBunny.Player.WALK_DEATH_ZONE&&this._setState(ChubbyBunny.Player.STATES.CARRY_WALK),this._target.sprite.x=this.sprite.x,this._target.flipSpriteX(this.sprite.scale.x<0);break;case ChubbyBunny.Player.STATES.CARRY_WALK:c<ChubbyBunny.Player.WALK_DEATH_ZONE/2?b.isDown?this._setState(ChubbyBunny.Player.STATES.CARRY_IDLE):(this._setState(ChubbyBunny.Player.STATES.IDLE),this._target.throw(),this._target=null,this._sfxThrow.play()):(this.sprite.x+=d*a*ChubbyBunny.Player.WALK_SPEED,this._flipSpriteX(d<0),this._target.sprite.x=this.sprite.x,this._target.flipSpriteX(d<0))}this.sprite.x<ChubbyBunny.BUNNY_MIN_X&&(this.sprite.x=this._moveto=ChubbyBunny.BUNNY_MIN_X)},ChubbyBunny.Player.prototype.setTarget=function(a){this._target!==a&&this._state!=ChubbyBunny.Player.STATES.CARRY_IDLE&&this._state!=ChubbyBunny.Player.STATES.CARRY_WALK&&(null!==this._target&&this._target.resume(),this._target=a,null!==this._target&&(a.wait(),this._setState(ChubbyBunny.Player.STATES.IDLE)))},ChubbyBunny.Player.prototype._setState=function(a){switch(this._state=a,this._state){case ChubbyBunny.Player.STATES.IDLE:this.sprite.animations.play("idle");break;case ChubbyBunny.Player.STATES.WALK:this.sprite.animations.play("walk");break;case ChubbyBunny.Player.STATES.KISS:this.sprite.animations.play("kiss");var b=this._target.sprite.x<this.sprite.x;this._flipSpriteX(b),this._target.flipSpriteX(!b),this._target.kiss(),this._moveto=this.sprite.x;break;case ChubbyBunny.Player.STATES.CARRY_IDLE:this.sprite.animations.play("carry_idle"),this._target.sprite.y=this.sprite.y+ChubbyBunny.Player.CARRY_OFFSET_Y,this._target.sprite.bringToTop();break;case ChubbyBunny.Player.STATES.CARRY_WALK:this.sprite.animations.play("carry_walk")}},ChubbyBunny.Player.prototype._flipSpriteX=function(a){this.sprite.scale.x=(a?-1:1)*Math.abs(this.sprite.scale.x)},ChubbyBunny.Boot=function(){Phaser.State.call(this)},ChubbyBunny.Boot.prototype=Object.create(Phaser.State.prototype),ChubbyBunny.Boot.prototype.constructor=ChubbyBunny.Boot,ChubbyBunny.Boot.prototype.init=function(){this.input.maxPointers=1,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.windowConstraints={right:"layout",bottom:"layout"},Phaser.Canvas.setImageRenderingCrisp(this.game.canvas)},ChubbyBunny.Boot.prototype.preload=function(){},ChubbyBunny.Boot.prototype.create=function(){this.state.start("Preloader")},ChubbyBunny.Game=function(){Phaser.State.call(this),this._loveMeter=null},ChubbyBunny.Game.prototype=Object.create(Phaser.State.prototype),ChubbyBunny.Game.prototype.constructor=ChubbyBunny.Game,ChubbyBunny.Game.HEALTH_METER_NUM_SPRITES=10,ChubbyBunny.Game.SPAWN_COUNT_MIN=3,ChubbyBunny.Game.SPAWN_COUNT_MAX=5,ChubbyBunny.Game.SPAWN_OFFSET_MIN=10,ChubbyBunny.Game.SPAWN_OFFSET_MAX=40,ChubbyBunny.Game.FOX_CHOKE_POINT_X=-140,ChubbyBunny.Game.MIN_BUNNIES_TO_WIN=16,ChubbyBunny.Game.prototype.create=function(){var a=new Phaser.Point(ChubbyBunny.WORLD_MAX.x-ChubbyBunny.WORLD_MIN.x,ChubbyBunny.WORLD_MAX.y-ChubbyBunny.WORLD_MIN.y);this.world.setBounds(ChubbyBunny.WORLD_MIN.x,ChubbyBunny.WORLD_MIN.y,a.x,a.y),this.add.tileSprite(ChubbyBunny.WORLD_MIN.x,ChubbyBunny.WORLD_MIN.y,a.x,a.y,"background"),this.add.tileSprite(ChubbyBunny.WORLD_MIN.x,ChubbyBunny.FLOOR_Y,a.x,ChubbyBunny.FLOOR_HEIGHT,"floor"),this.add.tileSprite(ChubbyBunny.WORLD_MIN.x,ChubbyBunny.WORLD_MIN.y,ChubbyBunny.WALL_WIDTH,ChubbyBunny.FLOOR_Y,"wall");var b=this.add.group();b.fixedToCamera=!0,this._loveMeter=this.add.sprite(8,8,"love_meter",null,b);var c=this.add.sprite(this.game.width/2,52,"win",null,b);c.anchor.setTo(.5,.5),c.scale.setTo(6,6),this._win=c;var d=this.add.sprite(this.game.width/2,52,"lose",null,b);d.anchor.setTo(.5,.5),d.scale.setTo(6,6),this._lose=d;var e=this.add.sprite(this.game.width/2,128,"retry",null,b);e.anchor.setTo(.5,.5),e.scale.setTo(3,3),this._retry=e,this._fox=new ChubbyBunny.Fox(this),this._bunniesGroup=this.add.group(),this._bunnies=new Array(100);for(var f=0,g=this._bunnies.length;f<g;f++)this._bunnies[f]=new ChubbyBunny.Bunny(this.game,this._bunniesGroup);this._player=new ChubbyBunny.Player(this.game),this.camera.follow(this._player.sprite),this._fox.head.bringToTop(),this._player.sprite.bringToTop(),this.world.bringToTop(b),this._sfxPoof=this.add.audio("poof",.7),this._sfxDeath=this.add.audio("death",.7);var h=this.add.audio("music",.4,!0);h.play(),this._reset()},ChubbyBunny.Game.prototype.update=function(){var a=this.input.activePointer;if(this._gameOver)return void(this._retry.visible?(this._pointerPrevDown===!0&&a.isUp&&this._reset(),this._pointerPrevDown=a.isDown):a.isUp&&(this._retry.visible=!0));var b,c,d;if(b=this.time.physicsElapsed,this._fox.update(b,0),this._fox.x<=ChubbyBunny.Game.FOX_CHOKE_POINT_X&&this._fox.numBunnies>=ChubbyBunny.Game.MIN_BUNNIES_TO_WIN)return this._fox.choke(),this._gameOver=!0,this._win.visible=!0,void(this._loveMeter.visible=!1);if(this._fox.bunniesEaten){for(c=0,d=this._bunnies.length;c<d;c++)this._bunnies[c].consume();this._sfxDeath.play()}if(this._player.update(b,a),this._loveMeter.frame=Math.floor(this._player.love*(ChubbyBunny.Game.HEALTH_METER_NUM_SPRITES-1)),this._player.spawnBunnies){var e=this.rnd.integerInRange(ChubbyBunny.Game.SPAWN_COUNT_MIN,ChubbyBunny.Game.SPAWN_COUNT_MAX);for(c=0,d=this._bunnies.length;c<d;c++)if(!this._bunnies[c].isActive()){var f=this._player.sprite.x+Math.sign(this.rnd.normal())*this.rnd.realInRange(ChubbyBunny.Game.SPAWN_OFFSET_MIN,ChubbyBunny.Game.SPAWN_OFFSET_MAX);if(this._bunnies[c].spawn(f),--e<=0)break}this._sfxPoof.play()}var g=null;for(c=0,d=this._bunnies.length;c<d;c++){var h=this._bunnies[c];h.isActive()&&(h.update(b,this._fox),a.isDown&&h.canBePicked()&&h.spriteContains(a.worldX,a.worldY)&&(g=h))}a.isDown&&this._player.setTarget(g),this._player.sprite.x>=this._fox.x&&(this._gameOver=!0,this._lose.visible=!0,this._loveMeter.visible=!1,this._player.sprite.visible=!1,this._fox.eatPlayer(),this._sfxDeath.play())},ChubbyBunny.Game.prototype.render=function(){this._bunnies[0].render()},ChubbyBunny.Game.prototype._reset=function(){this._gameOver=!1,this._pointerPrevDown=null,this._win.visible=!1,this._lose.visible=!1,this._retry.visible=!1,this._loveMeter.visible=!0,this._fox.initialize();for(var a=0,b=this._bunnies.length;a<b;a++)this._bunnies[a].initialize();this._bunnies[0].spawn(-32,!0),this._player.sprite.visible=!0,this._player.initialize()},ChubbyBunny.Preloader=function(){Phaser.State.call(this)},ChubbyBunny.Preloader.prototype=Object.create(Phaser.State.prototype),ChubbyBunny.Preloader.prototype.constructor=ChubbyBunny.Preloader,ChubbyBunny.Preloader.prototype.preload=function(){this.load.image("background","assets/imgs/background.png"),this.load.image("floor","assets/imgs/floor.png"),this.load.image("wall","assets/imgs/wall.png"),this.load.spritesheet("love_meter","assets/imgs/love_meter.png",16,16),this.load.image("win","assets/imgs/win.png"),this.load.image("lose","assets/imgs/lose.png"),this.load.image("retry","assets/imgs/retry.png"),this.load.spritesheet("bunny","assets/imgs/bunny.png",32,32),this.load.image("fox_body_bg","assets/imgs/fox_body_bg.png"),this.load.image("fox_body_fg","assets/imgs/fox_body_fg.png"),this.load.image("fox_head_bg","assets/imgs/fox_head_bg.png"),this.load.spritesheet("fox_head_fg","assets/imgs/fox_head_fg.png",99,40),this.load.audio("poof","assets/sfxs/poof.ogg"),this.load.audio("pick_up","assets/sfxs/pick_up.ogg"),this.load.audio("throw","assets/sfxs/throw.ogg"),this.load.audio("death","assets/sfxs/death.ogg"),this.load.audio("music","assets/mp3s/Kick Shock.mp3?v=2")},ChubbyBunny.Preloader.prototype.update=function(){this.cache.isSoundDecoded("music")&&this.state.start("Game")},ChubbyBunny.TitleScreen=function(){Phaser.State.call(this)},ChubbyBunny.TitleScreen.prototype=Object.create(Phaser.State.prototype),ChubbyBunny.TitleScreen.prototype.constructor=ChubbyBunny.TitleScreen,ChubbyBunny.TitleScreen.prototype.create=function(){},ChubbyBunny.TitleScreen.prototype.start=function(){};
//# sourceMappingURL=app.js.map